@model Todo
@{
    var userRole = Context.Session.GetString("userRole");
}

<h2 style="text-align: center; margin-bottom: 20px;">New Task</h2>

<div class="row" style="width: 50%; margin: 40px auto; align-items: center; background: rgba(255,255,255,0.25); border-radius: 20px; box-shadow: 0 2px 16px rgba(0,0,0,0.08); padding: 32px 24px;">
    <form asp-action="Add" method="post">
        <div class="row">
            <div class="mb-2 col-6">
                <label asp-for="todName" class="form-label">Name</label>
                <span asp-validation-for="todName" class="text-danger" style="margin-left:8px; font-size:0.95em;"></span>
                <input asp-for="todName" class="form-control" maxlength="15" minlength="3" />
            </div>
            <div class="mb-3 col-6">
                <label asp-for="todDescription" class="form-label">Description</label>
                <span asp-validation-for="todDescription" class="text-danger" style="margin-left:8px; font-size:0.95em;"></span>
                <input asp-for="todDescription" class="form-control" />
            </div>
        </div>
        <div class="row">
            @if (userRole == "Team Member")
            {
                <div class="mb-3 col-6">
                    <label asp-for="categoryId" class="form-label">Category</label>
                    <span asp-validation-for="categoryId" class="text-danger" style="margin-left:8px; font-size:0.95em;"></span>
                    <select asp-for="categoryId" class="form-select">
                        <option value="">Select a Category</option>
                        @foreach (var cat in (List<tod.Models.Category>)ViewBag.Categories)
                        {
                            if (cat.categoryId != "work")
                            {
                                <option value="@cat.categoryId">@cat.categoryName</option>
                            }
                        }
                    </select>
                </div>
            }
            @* Team Leader ise kategori alanı hiç gösterilmesin *@
            <input type="hidden" name="categoryId" value="work" />
            <div class="mb-3 col-6">
                <label asp-for="statusId" class="form-label">Status</label>
                <span asp-validation-for="statusId" class="text-danger" style="margin-left:8px; font-size:0.95em;"></span>
                <select asp-for="statusId" class="form-select" asp-items="@(new SelectList(ViewBag.Statuses, "statusId", "statusName"))">
                    <option value="">Select a Status</option>
                </select>
            </div>
        </div>
        <div class="mb-3">
            <label asp-for="dueDate" class="form-label">Due Date</label>
            <span asp-validation-for="dueDate" class="text-danger" style="margin-left:8px; font-size:0.95em;"></span>
            <input asp-for="dueDate" class="form-control" type="date" />
        </div>
        @if (ViewBag.TeamMembers != null && ((List<tod.Models.User>)ViewBag.TeamMembers).Count > 0)
        {
            <div class="mb-3">
                <label class="form-label">Assign To</label>
                <select class="form-select" name="assignedUserId">
                    <option value="">Select a User</option>
                    @foreach (var member in (List<tod.Models.User>)ViewBag.TeamMembers)
                    {
                        <option value="@member.userId">@member.userName (@member.userMail)</option>
                    }
                </select>
            </div>
        }
        <button type="submit" class="btn btn-info">Add</button>
        <a asp-action="Index" class="btn btn-warning">Cancel</a>
    </form>
</div>